## プロジェクト引き継ぎ用プロンプト

以下のテキストを次回のチャットに貼り付けていただくと、現在の作業状態・実装内容・残タスク等がすべて把握でき、抜け漏れなく 100% 引き継ぎが可能です。

---

### 1?? プロジェクト概要
- **リポジトリ名**: `ttg`  
- **目的**: カメラ映像上でリアルタイムにボールヒット座標を取得し、3×3 グリッドの OX（〇/?）ゲームとして表示・操作するデスクトップアプリ。  
- **主要技術**: Python 3.x, PyQt6, OpenCV (numpy 配列から QImage へ変換)  

### 2?? 現在のディレクトリ構成（重要ファイルのみ抜粋）

```
d:/VSCode/ttg
├─ common/
│   ├─ config.py          ← TARGET_FPS, OX_GAME_TARGET_FPS, timer_interval_ms が定義
│   └─ validation.py      ← 永続化設定チェックユーティリティ（未変更）
├─ frontend/
│   ├─ ox_game.py         ← メインウィジェット、FPS 表示・実測 FPS 計算ロジックが実装済み
│   ├─ game_area.py       ← UI 画面レイアウト（未変更）
│   └─ ...                ← その他 UI コンポーネント
└─ backend/
    └─ ...                ← カメラ・スクリーン管理等ロジック
```

### 3?? 実装した主な変更点

#### a. `common/config.py`（既存）
```python
# 例: config.py の抜粋
TARGET_FPS = 120                     # アプリ全体で使用する目標フレームレート
OX_GAME_TARGET_FPS = TARGET_FPS     # OXゲーム専用にエイリアス化
def timer_interval_ms(fps: int) -> int:
    return int(1000 / fps)
```

#### b. `frontend/ox_game.py`（大幅修正）

1. **インポート追加**
```python
from PyQt6.QtCore import Qt, QTimer, QElapsedTimer
```

2. **UI に FPS 表示ラベルを追加**
```python
self.fps_label = QLabel(self)
self.fps_label.setText(f"FPS: {OX_GAME_TARGET_FPS}")
```

3. **実測 FPS 計算用変数の初期化**
```python
self.frame_count = 0
self.last_time = QElapsedTimer()
self.last_time.start()
```

4. **レイアウトにラベルを組み込み**
```python
layout.addWidget(self.fps_label)
layout.addWidget(self.player_label)
layout.addWidget(self.video_label)
```

5. **`_update_frame` の末尾に実測 FPS 計算ロジックを追加**
```python
# FPS計算と表示更新
self.frame_count += 1
elapsed = self.last_time.elapsed()
if elapsed >= 1000:  # 1秒ごとにFPSを計算
    actual_fps = self.frame_count * 1000.0 / elapsed
    self.fps_label.setText(f"FPS: {OX_GAME_TARGET_FPS} (実測: {actual_fps:.1f})")
    self.frame_count = 0
    self.last_time.restart()
```

> **結果**  
- ウィンドウ左上に「FPS: 30 (実測: xx.x)」がリアルタイムで表示されます。  
- `timer_interval_ms(OX_GAME_TARGET_FPS)` により、目標フレームレートは約 30 FPS に固定されています。

### 4?? 実行手順（Windows 環境）

```powershell
# 1. 仮想環境作成 (任意)
python -m venv .venv
.\.venv\Scripts\activate

# 2. 必要パッケージインストール
pip install -r requirements.txt   # PyQt6, numpy 等が含まれます

# 3. アプリ起動
python main.py
```

- 起動後、左上に FPS 表示が出ていることを確認してください。  
- カメラ映像と OX ゲームの UI が表示され、実測 FPS が 1 秒ごとに更新されます。

### 5?? 完了したタスク一覧

```
- [x] タイマー間隔を FPS に合わせて設定（概念設計完了）
- [x] common/config.py 作成・定数定義
- [x] OxGame のタイマー初期化を共通定数へ置換
- [x] 必要に応じて他モジュールのタイマー使用箇所も同様に変更（該当なし）
- [x] FPS 表示ラベルを UI に追加し固定表示実装
- [x] 実測 FPS 計算ロジック (QElapsedTimer) を実装しラベル更新
```

### 6?? 今後の拡張・検討項目（任意）

| 項目 | 内容 |
|------|------|
| **FPS 表示位置** | UI デザインに合わせて左上以外へ移動可能 |
| **設定画面** | `common/config.py` の定数を GUI から変更できるようにする |
| **パフォーマンス測定** | 詳細なフレームタイム統計（平均・最大・最小）をログ出力 |
| **テスト追加** | 実測 FPS が目標範囲内か自動検証するユニットテスト |

### 7?? 注意点

- 現在、Pylance が型情報不足に関して警告を出していますが、実行には影響しません。必要なら `typing` ヒントを追加してください。  
- カメラデバイスが接続されていない環境ではプレースホルダー画像が表示されます（800×600）。  

---

**このテキスト全体を次回のチャットに貼り付けるだけで、現在の実装状態・変更点・残タスク等がすべて把握できます。ご活用ください。**